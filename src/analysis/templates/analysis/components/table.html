<div class="card card-dark overflow-hidden">
    <div class="table-responsive">
        <table class="table table-dark-custom align-middle mb-0">
            <thead>
                <tr class="text-uppercase small text-secondary border-bottom border-secondary">
                    
                    <!-- 1. ID -->
                    <th class="ps-4 py-3">
                        <a href="javascript:applySort('pokedex_id')" 
                           class="sort-link {% if filters.current_sort == 'pokedex_id' %}text-white{% endif %}">
                            ID 
                            {% if filters.current_sort == 'pokedex_id' %}
                                {% if filters.current_dir == 'asc' %} <i class="bi bi-arrow-up text-danger"></i>
                                {% else %} <i class="bi bi-arrow-down text-danger"></i>
                                {% endif %}
                            {% else %}
                                <i class="bi bi-arrow-down-up sort-icon opacity-50"></i>
                            {% endif %}
                        </a>
                    </th>

                    <!-- 2. Nombre -->
                    <th class="py-3">
                        <a href="javascript:applySort('name')" 
                           class="sort-link {% if filters.current_sort == 'name' %}text-white{% endif %}">
                            Nombre 
                            {% if filters.current_sort == 'name' %}
                                {% if filters.current_dir == 'asc' %} <i class="bi bi-arrow-up text-danger"></i>
                                {% else %} <i class="bi bi-arrow-down text-danger"></i>
                                {% endif %}
                            {% else %}
                                <i class="bi bi-arrow-down-up sort-icon opacity-50"></i>
                            {% endif %}
                        </a>
                    </th>

                    <!-- 3. Tipo(s) -->
                    <th class="py-3">
                        <a href="javascript:applySort('types_count')" 
                           class="sort-link {% if filters.current_sort == 'types_count' %}text-white{% endif %}">
                            Tipo(s)
                            {% if filters.current_sort == 'types_count' %}
                                {% if filters.current_dir == 'asc' %} <i class="bi bi-arrow-up text-danger"></i>
                                {% else %} <i class="bi bi-arrow-down text-danger"></i>
                                {% endif %}
                            {% else %}
                                <i class="bi bi-arrow-down-up sort-icon opacity-50"></i>
                            {% endif %}
                        </a>
                    </th>
                    
                    <!-- 4. Altura (CM) -->
                    <th class="py-3 text-end">
                        <a href="javascript:applySort('height')" 
                           class="sort-link justify-content-end {% if filters.current_sort == 'height' %}text-white{% endif %}">
                            Altura (cm)
                            {% if filters.current_sort == 'height' %}
                                {% if filters.current_dir == 'asc' %} <i class="bi bi-arrow-up text-danger"></i>
                                {% else %} <i class="bi bi-arrow-down text-danger"></i>
                                {% endif %}
                            {% else %}
                                <i class="bi bi-arrow-down-up sort-icon opacity-50"></i>
                            {% endif %}
                        </a>
                    </th>

                    <!-- 5. Peso (Kg) -->
                    <th class="py-3 text-end pe-4">
                        <a href="javascript:applySort('weight')" 
                           class="sort-link justify-content-end {% if filters.current_sort == 'weight' %}text-white{% endif %}">
                            Peso (kg)
                            {% if filters.current_sort == 'weight' %}
                                {% if filters.current_dir == 'asc' %} <i class="bi bi-arrow-up text-danger"></i>
                                {% else %} <i class="bi bi-arrow-down text-danger"></i>
                                {% endif %}
                            {% else %}
                                <i class="bi bi-arrow-down-up sort-icon opacity-50"></i>
                            {% endif %}
                        </a>
                    </th>

                    <!-- 6. Transformación de Datos -->
                    <th class="py-3 text-end pe-4">
                        <a href="javascript:applySort('transformed')" 
                           class="sort-link justify-content-end {% if filters.current_sort == 'transformed' %}text-white{% endif %}">
                            Transformación de Datos
                            {% if filters.current_sort == 'transformed' %}
                                {% if filters.current_dir == 'asc' %} <i class="bi bi-arrow-up text-danger"></i>
                                {% else %} <i class="bi bi-arrow-down text-danger"></i>
                                {% endif %}
                            {% else %}
                                <i class="bi bi-arrow-down-up sort-icon opacity-50"></i>
                            {% endif %}
                        </a>
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for p in pokemons %}
                <tr>
                    <td class="ps-4">
                        <span class="poke-id">#{{ p.pokedex_id|stringformat:"03d" }}</span>
                    </td>
                    <td>
                        <strong class="fs-5">{{ p.name|title }}</strong>
                    </td>
                    <td>
                        {% for t in p.type_list %}
                            <span class="badge badge-type type-{{ t|default:'default' }}">{{ t }}</span>
                        {% endfor %}
                    </td>
                    
                    <!-- Altura CM -->
                    <td class="text-end text-secondary">
                        <i class="bi bi-rulers"></i> {{ p.height_cm }} cm
                    </td>
                    
                    <!-- Peso KG -->
                    <td class="text-end pe-4 text-secondary">
                        <i class="bi bi-hdd-stack"></i> {{ p.weight_kg }} kg
                    </td>

                    <!-- Transformado -->
                    <td class="text-end pe-4">
                        <span class="dna-text">{{ p.transformed_value }}</span>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-5">
                        <div class="opacity-50">
                            <i class="bi bi-robot display-1 mb-3"></i>
                            <h4 class="mt-2">No hay coincidencia</h4>
                            <p>Ajuste los parámetros del filtro superior.</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- FOOTER: SELECTOR DE REGISTROS -->
    <div class="card-footer bg-dark border-top border-secondary py-2">
        <div class="d-flex justify-content-between align-items-center">
            
            <!-- Contador -->
            <div class="text-secondary small">
                Mostrando <strong>{{ pokemons|length }}</strong> de <strong>{{ total_found }}</strong> encontrados.
            </div>

            <!-- Selector de Cantidad -->
            <div class="d-flex align-items-center gap-2">
                <label for="rowsLimit" class="text-secondary small fw-bold text-uppercase">Filas:</label>
                <select id="rowsLimit" class="form-select form-select-sm form-select-dark" 
                        style="width: 70px;" 
                        onchange="applyLimit(this.value)">
                    <option value="10" {% if current_limit == 10 %}selected{% endif %}>10</option>
                    <option value="25" {% if current_limit == 25 %}selected{% endif %}>25</option>
                    <option value="50" {% if current_limit == 50 %}selected{% endif %}>50</option>
                </select>
            </div>
        </div>
    </div>
</div>

<script>
    function applyLimit(val) {
        const url = new URL(window.location.href);
        url.searchParams.set('limit', val);
        window.location.href = url.toString();
    }
</script>